@using Microsoft.AspNetCore.Components
@inject NavigationManager Nav

<nav aria-label="pagination">
    <ul class="pagination">
        <li class="page-item @(Page <= 1 ? "disabled" : null)">
            <a class="page-link"
               href="@($"{new Uri(Nav.Uri).PathAndQuery}#page-heading")"
               @onclick="() => Go(Page - 1)">Prev</a>
        </li>

        @foreach (var p in Pages())
        {
            <li class="page-item @(p == Page ? "active" : null)">
                <a class="page-link"
                   href="@($"{new Uri(Nav.Uri).PathAndQuery}#page-heading")"
                   aria-current="@(p == Page ? "page" : null)"
                   @onclick="() => Go(p)">@p</a>
            </li>
        }

        <li class="page-item @(Page >= TotalPages ? "disabled" : null)">
            <a class="page-link"
               href="@($"{new Uri(Nav.Uri).PathAndQuery}#page-heading")"
               @onclick="() => Go(Page + 1)">Next</a>
        </li>
    </ul>
</nav>

@code {
    [Parameter] public int Page { get; set; } = 1;
    [Parameter] public int PageSize { get; set; } = 20;
    [Parameter] public int Total { get; set; } = 0;
    [Parameter] public EventCallback<int> OnChange { get; set; }

    private int TotalPages => Math.Max(1, (int)Math.Ceiling((double)Total / PageSize));

    private async Task Go(int p)
    {
        p = Math.Clamp(p, 1, TotalPages);
        if (p == Page) return;
        await OnChange.InvokeAsync(p);
    }

    private IEnumerable<int> Pages()
    {
        const int window = 2;
        var start = Math.Max(1, Page - window);
        var end = Math.Min(TotalPages, Page + window);
        for (int i = start; i <= end; i++) yield return i;
    }
}
